<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>R course</title>
    <meta charset="utf-8" />
    <meta name="author" content="" />
    <script src="libs/header-attrs-2.20/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/Font_Style.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# R course
]
.author[
### 
]

---

class: center, middle
&lt;span style="font-size: 60px;"&gt;第十章&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 50px;"&gt; Git and Tidy Codes&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;版本控制与整洁的代码&lt;/span&gt; &lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;span style="font-size: 30px;"&gt;胡传鹏&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;2023/05/08&lt;/span&gt; &lt;br&gt;
---
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;span style="font-size: 60px;"&gt;10.1 Git and GitHub&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;span style="font-size: 60px;"&gt;10.2 Files and Folders System&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;span style="font-size: 60px;"&gt;10.3 Tidy Code&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;span style="font-size: 60px;"&gt;10.4 OCD-level Codes&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;br&gt;


---
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;span style="font-size: 60px;"&gt;10.1 Git and GitHub&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.1.1 Download Git&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.1.2 Sign up GitHub&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.1.3 New repository&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.1.4 Download GitHub Desktop&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.1.5 GitHub Desktop: Clone repository&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.1.6 Create README&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.1.7 First Commit&lt;/span&gt; &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.1.1 Download Git&lt;/h1&gt; 
&lt;img src="./picture/chp10/git.png" width="100%"&gt; &lt;br&gt;
- Git是版本控制的工具，GitHub是存放你历史版本的平台 &lt;br&gt;
- 首先，我们要下载Git https://git-scm.com/downloads &lt;br&gt;
- ~~(可能你直接安装GitHub Desktop也会自动安装Git)~~

---
## &lt;h1 lang="en"&gt;10.1.2 Sign up GitHub&lt;/h1&gt; 
&lt;img src="./picture/chp10/signup_github_1.png" width="100%"&gt; &lt;br&gt;
- 注册一个GitHub账号 https://github.com &lt;br&gt;
- ~~推荐使用outlook, gmail, icloud, hotmail, yahoo等"你懂的"邮箱~~

---
## &lt;h1 lang="en"&gt;10.1.3 New repository&lt;/h1&gt; 
&lt;img src="./picture/chp10/new_repo.png" width="100%"&gt; &lt;br&gt;
- 在自己的用户界面找到repository，点击new &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.1.3 New repository&lt;/h1&gt; 
&lt;img src="./picture/chp10/repo_name.png" width="70%"&gt; &lt;br&gt;
- 设定一个repository的名字，然后点击create repository &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.1.4 Download GitHub Desktop&lt;/h1&gt; 
&lt;img src="./picture/chp10/github_desktop.png" width="100%"&gt; &lt;br&gt;
- 下载安装 GitHub Desktop https://desktop.github.com/ &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.1.5 GitHub Desktop: Clone repository&lt;/h1&gt; 
&lt;img src="./picture/chp10/desktop_clone.png" width="100%"&gt; &lt;br&gt;
- 打开GitHub Desktop，点击 Add -- Clone repository &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.1.5 GitHub Desktop: Clone repository&lt;/h1&gt; 
&lt;img src="./picture/chp10/desktop_clone_path.png" width="90%"&gt; &lt;br&gt;
- 选择你刚刚创建的repository &lt;br&gt;
- 设定你想保存的本地地址，点击clone  &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.1.5 GitHub Desktop: Clone repository&lt;/h1&gt; 
&lt;img src="./picture/chp10/hide_file.png" width="100%"&gt; &lt;br&gt;
- 点击"查看"，点击"显示隐藏的项目" &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.1.5 GitHub Desktop: Clone repository&lt;/h1&gt; 
&lt;img src="./picture/chp10/git_hide.png" width="100%"&gt; &lt;br&gt;
- 可以看到一个半透明的git文件夹 &lt;br&gt;
- git文件夹内会记录你对Example这个文件夹的每一次修改 &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.1.6 Create README&lt;/h1&gt; 
&lt;img src="./picture/chp10/README.png" width="100%"&gt; &lt;br&gt;
- 我们创建一个READEME &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.1.7 First Commit&lt;/h1&gt; 
&lt;img src="./picture/chp10/README_commit.png" width="90%"&gt; &lt;br&gt;
 - 左下角，如果你只是更改了一个文件，GitHub Desktop会自动帮你命名(版本名) &lt;br&gt;
 - 你只需要写一个Description来描述你这一次做了些什么&lt;br&gt;
 - 写完后点击Commit to main &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.1.7 First Commit&lt;/h1&gt; 
&lt;img src="./picture/chp10/publish_branch.png" width="90%"&gt; &lt;br&gt;
- 点击右侧的publish_branch，上传到GitHub &lt;br&gt;
- (如果是第二次写commit，这里会变成push origin) &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.1.7 First Commit&lt;/h1&gt; 
&lt;img src="./picture/chp10/readme_web.png" width="100%"&gt; &lt;br&gt;
- README会在网页上显示，方便他人查看 &lt;br&gt;
---
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;span style="font-size: 60px;"&gt;10.2 Files and Folders System&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.2.0 Root Directory&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.2.1 "1_Protocol"&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.2.2 "2_Literature_Search"&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.2.3 "3_Article_Screen"&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.2.4 "4_Data_Extraction"&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.2.5 "5_Analysis"&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.2.6 "6_Reports"&lt;/span&gt; &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.2.0 Root Directory &lt;/h1&gt; 
&lt;br&gt;
- 1_Protocol &lt;br&gt;
- 2_Literature_Search &lt;br&gt;
- 3_Article_Screen &lt;br&gt;
- 4_Data_Extraction &lt;br&gt;
- 5_Analysis &lt;br&gt;
- 6_Reports &lt;br&gt;
&lt;br&gt;
- .git &lt;br&gt;
- .gitignore &lt;br&gt;
- README.md(.txt) &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.2.1 "1_Protocol"&lt;/h1&gt; 
&lt;img src="./picture/chp10/1_protocol.png" width="120%"&gt; &lt;br&gt;
- 包含"预注册报告的文章"和"该研究会用到的所有代码" &lt;br&gt;
- 当然，这些代码是使用模拟数据运行的 &lt;br&gt;
- About.txt是类似README一样的说明文档 &lt;br&gt;

_仅供举例，非Example中内容_

---
## &lt;h1 lang="en"&gt;10.2.2 "2_Literature_Search"&lt;/h1&gt; 
&lt;img src="./picture/chp10/2_literature_search.png" width="120%"&gt; &lt;br&gt;
- 这一部分相对自由 &lt;br&gt;
- 主要包含了你在进行这个项目中阅读过的参考文献 &lt;br&gt;
- 这个文件夹通常会被放在gitignore中，因为这些pdf并不需要被上传到GitHub &lt;br&gt;

_仅供举例，非Example中内容_

---
## &lt;h1 lang="en"&gt;10.2.3 "3_Article_Screen"&lt;/h1&gt; 
&lt;img src="./picture/chp10/3_article_screen.png" width="120%"&gt; &lt;br&gt;
- yuki一般会在这里存放Endnote文件 &lt;br&gt;
- 阅读文献时的笔记，也可以记录在Endnote中 &lt;br&gt;
- 这个文件夹内的文件可以忽略，也可以保留 &lt;br&gt;
- yuki上传了".enl"文件，这样当yuki在其他电脑上修改文章中的引用信息时，仍然可以使用Endnote来管理 &lt;br&gt;

_仅供举例，非Example中内容_

---
## &lt;h1 lang="en"&gt;10.2.4 "4_Data_Extraction"&lt;/h1&gt; 
&lt;img src="./picture/chp10/4_data_extraction.png" width="90%"&gt; &lt;br&gt;
- 这个文件夹内存放你所有的实验数据 &lt;br&gt;
- 图片中的项目是对SPMT这个范式进行信度分析 &lt;br&gt;
- 因此有一份传鹏自己的数据，以及其他很多公开的数据 &lt;br&gt;
- 这部分的文件也相对自由，你需要根据自己的实验来整理 &lt;br&gt;
- 比如4_1_Study1, 4_2_Study2 &lt;br&gt;

_仅供举例，非Example中内容_

---
## &lt;h1 lang="en"&gt;10.2.5 "5_Analysis"&lt;/h1&gt; 
&lt;img src="./picture/chp10/5_analysis.png" width="60%"&gt; &lt;br&gt;
- 这个部分存放你正式实验时的分析代码 &lt;br&gt;
- 今天的Example就是单独将这一部分演示了上传与同步GitHub &lt;br&gt;
- 当你正式开展一个项目时，应该包含10.2 Files and Folders System 的所有内容  &lt;br&gt;

_仅供举例，非Example中内容_

---
## &lt;h1 lang="en"&gt;10.2.6 "6_Reports"&lt;/h1&gt; 
&lt;img src="./picture/chp10/6_reports.png" width="120%"&gt; &lt;br&gt;
- 这个部分存放你汇报时的PPT &lt;br&gt;

_仅供举例，非Example中内容_

---
## &lt;h1 lang="en"&gt;Extra&lt;/h1&gt; 
&lt;img src="./picture/chp10/jyqwbxqz.png" width="100%"&gt; &lt;br&gt;
- 不要让你的文件夹外部看起来非常整洁 &lt;br&gt;
- 但当打开几个文件夹后，内部文件的存放毫无逻辑 &lt;br&gt;

---
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;span style="font-size: 60px;"&gt;10.3 Tidy Code&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.3.1 Create a R project&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.3.2 Create a R markdown&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.3.3 Write Codes in Chunks&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.3.4 Create Folders&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.3.5 Create Lists for (df, out, p,...)&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.3.6 df: Clean Data&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.3.7 out: MANOVA&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.3.8 plot: ggplot2&lt;/span&gt; &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.3.1 Create a R project&lt;/h1&gt; 
&lt;img src="./picture/chp10/new_project.png" width="100%"&gt; &lt;br&gt;
- 如果你要做一个新的项目，创建一个R project &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.3.1 Create a R project&lt;/h1&gt; 
&lt;img src="./picture/chp10/new_project_path.png" width="90%"&gt; &lt;br&gt;
- 设定路径为我们刚刚创建的git文件夹Example &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.3.1 Create a R project&lt;/h1&gt; 
&lt;img src="./picture/chp10/new_project_window.png" width="90%"&gt; &lt;br&gt;
- 创建完成后会打开一个新的R studio窗口 &lt;br&gt;
- (可以看到R studio识别到这是一个git文件夹，自动帮我们创建了R相关的.gitignore) &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.3.2 Create a R markdown&lt;/h1&gt; 
&lt;img src="./picture/chp10/new_rmarkdown.png" width="100%"&gt; &lt;br&gt;
- 创建一个rmarkdown用来写代码 &lt;br&gt;
- 不要创建R script, 它没有Chunk，代码会很乱&lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.3.2 Create a R markdown&lt;/h1&gt; 
&lt;img src="./picture/chp10/create_rmarkdown_title.png" width="90%"&gt; &lt;br&gt;
- 给这个Rmarkdown取一个名字，最好使用驼峰式大小写&lt;br&gt;
- ~~(如果你没有强迫症，可以全部小写或全部大写)~~ &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.3.2 Create a R markdown&lt;/h1&gt; 
&lt;img src="./picture/chp10/new_rmarkdown_1.png" width="100%"&gt; &lt;br&gt;
- 这就算创建好了一个R markdown，会有默认的几行代码作为示例&lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.3.2 Create a R markdown&lt;/h1&gt; 
&lt;img src="./picture/chp10/new_rmarkdown_save.png" width="90%"&gt; &lt;br&gt;
- 保存这个R markdown，名字可以与之前的Title一致，也可以不一致&lt;br&gt;
- ~~强迫症一定会写一致~~ &lt;br&gt;
- 你刚刚只是创建了这个R markdown，可以在右侧的Files看到，并没有rmd文件&lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.3.3 Write Codes in Chunks&lt;/h1&gt; 
&lt;img src="./picture/chp10/chunk_library.png" width="100%"&gt; &lt;br&gt;
- 一个Chunk由这样几部分组成&lt;br&gt;
1. 三个 "`" 数字键1左边的点，表示这个Chunk的开始&lt;br&gt;
2. 大括号 "{}" 字母键P右边，表示这个Chunk内的语言是什么语言&lt;br&gt;
3. 大括号内， ","逗号后的argument，比如warning = FALSE 意味着这段Chunk在运行后不会出现warning&lt;br&gt;
4. 三个 "`" 表示这个Chunk的结束&lt;br&gt;
5. 最右侧的绿色三角，表示运行这个Chunk
&lt;br&gt;
_- 一些强迫症的东西_&lt;br&gt;
_a. 等号左右的空格_&lt;br&gt;
_b. 逗号后面的空格_&lt;br&gt;
_c. 赋值符号 " &lt;- " 左右的空格_&lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.3.3.1 Notes&lt;/h1&gt; 

```r
  # Scientific notation
  options(scipen = 999)

  # Convert data.frame to data.table
  setDT(df.split)

  # setting subject and splitting the data by var1, var2, var3
  split_data &lt;- split(df.split, list(df.split[[sub]], df.split[[var1]],
                                     df.split[[var2]], df.split[[var3]]))
```
- 每写一行代码，写一行注释 &lt;br&gt;
- 如果你让GPT帮你写代码(比如这里的代码)，他自然就会给每行代码添加注释 &lt;br&gt;
&lt;br&gt;
_仅供举例，非Example中内容_

---
## &lt;h1 lang="en"&gt;10.3.3.2 Variable Names&lt;/h1&gt; 

```r
# 局部变量的变量名可以不带任何定语,状语
data &lt;- read.csv("./yourdata.csv")

# 当然这不是真正意义上的局部变量。只是说这个变量只在这个chunk中使用
# 这样的局部变量，在使用完后，一定要清除
rm(data)

# 全局变量的变量名尽可能用简单的字母描述他是什么
df.icc &lt;- df.raw %&gt;%
  dplyr::filter(ACC == 1 | ACC == 0)

# 其实，除非你在function内写代码，你的变量都是全局变量
# 我这里指的全局变量是你在之后的代码中依然会使用的变量
# 因此它的名字一定是可以让你直觉的想到，这是做什么的
```
- 但是这种做法也有弊端 &lt;br&gt;
- 当你需要用到非常多变量的时候，如果所有变量都是全局变量，再标准化的变量名，也不能让读者甚至让你自己明白这个变量指代的是什么 &lt;br&gt;
&lt;br&gt;
_仅供举例，非Example中内容_

---
## &lt;h1 lang="en"&gt;10.3.3.2 Variable Names&lt;/h1&gt; 
&lt;img src="./picture/chp10/badexample.png" width="100%"&gt; &lt;br&gt;
- 你也不想你的代码变成这样吧 &lt;br&gt;
&lt;br&gt;
_仅供举例，非Example中内容_

---
## &lt;h1 lang="en"&gt;10.3.4 Create Folders&lt;/h1&gt; 
&lt;img src="./picture/chp10/folders.png" width="80%"&gt; &lt;br&gt;
- yuki认为更好的方法是将每一步操作，每一个结果都存放进list中 &lt;br&gt;
- 首先，我们创建三个文件夹，分别用来存放数据，结果和图片

---
## &lt;h1 lang="en"&gt;10.3.5 Create Lists for (df, out, p,...)&lt;/h1&gt; 
&lt;img src="./picture/chp10/NULL_list.png" width="100%"&gt; &lt;br&gt;
- 代码中，我们对应创建三个list &lt;br&gt;
- 分别存放所有的数据集，所有的结果文件，所有的图片&lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.3.6 df: Clean Data&lt;/h1&gt; 
&lt;img src="./picture/chp10/df_clean_data.png" width="90%"&gt; &lt;br&gt;
- 每一步操作，对应df这个list中的一个元素 &lt;br&gt;
- 做完每一步操作，都给这个list中的对应元素命名 &lt;br&gt;
- Chunk的名字，很多时候比Notes注释更好用。

---
## &lt;h1 lang="en"&gt;10.3.6 df: Clean Data&lt;/h1&gt; 
&lt;img src="./picture/chp10/cleandata_example.png" width="100%"&gt; &lt;br&gt;
- 尤其是当你做完每一个清洗数据的Chunk，然后把所有Chunk收起时 &lt;br&gt;
- 你的每一步操作，一目了然 &lt;br&gt;
&lt;br&gt;
_仅供举例，非Example中内容_

---
## &lt;h1 lang="en"&gt;10.3.6 df: Clean Data&lt;/h1&gt; 
&lt;img src="./picture/chp10/cleandata_list.png" width="110%"&gt; &lt;br&gt;
- 点开df这个list &lt;br&gt;
- 相较于全局变量中的变量名，list中元素的名称可以更长，更多"非法字符" &lt;br&gt;
- 换句话说，更容易让你自己理解每一步在做什么 &lt;br&gt;
&lt;br&gt;
_仅供举例，非Example中内容_

---
## &lt;h1 lang="en"&gt;10.3.6 df: Clean Data&lt;/h1&gt; 
&lt;img src="./picture/chp10/df_environment.png" width="100%"&gt; &lt;br&gt;
- 同时，这样也可以保证你的Global Environment很干净 &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.3.6 df: Clean Data&lt;/h1&gt; 
&lt;img src="./picture/chp10/cleandata_bad.png" width="80%"&gt; &lt;br&gt;
- 你也不想你的Global Environment变成这样吧 &lt;br&gt;
&lt;br&gt;
_仅供举例，非Example中内容_

---
## &lt;h1 lang="en"&gt;10.1.8 Second Commit&lt;/h1&gt; 
&lt;img src="./picture/chp10/second_commit.png" width="100%"&gt; &lt;br&gt;
- 假设今天做到这里下班了，你可以上传你刚刚的成果到GitHub上 &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.1.8 Second Commit&lt;/h1&gt; 
&lt;img src="./picture/chp10/second_commit_web.png" width="80%"&gt; &lt;br&gt;
- 网页上会显示你刚刚的更新 &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.3.7 out: MANOVA&lt;/h1&gt; 
&lt;img src="./picture/chp10/OUTPUT_1.png" width="80%"&gt; &lt;br&gt;
- 我们新建一个RMD来写结果部分的代码 &lt;br&gt;
- 你可能现在觉得，之前Clean Data的RMD只有几行，为什么不接着写，而要重开一个新的RMD &lt;br&gt;
- 但如果当你所有代码有上千行的时候，都放在一个RMD里，哪怕你标题层级再清晰，也会很难找到你想修改的那部分代码了 &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.3.8 plot: ggplot2&lt;/h1&gt; 
&lt;img src="./picture/chp10/palette.png" width="100%"&gt; &lt;br&gt;
- 再新建一个RMD写画图的代码 &lt;br&gt;
- 为了画图，我们预先设定好一个调色盘palette，便于之后提取颜色 &lt;br&gt;
- ~~颜色搭配来源于知乎~~ &lt;br&gt;
- 由于三种颜色组合都被存入了list palette中，因此这三个颜色变量就是冗余数据了，应该及时从环境变量中清除 &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.3.8 plot: ggplot2&lt;/h1&gt; 
&lt;img src="./picture/chp10/ggplot2.png" width="100%"&gt; &lt;br&gt;
- 用ggplot2画一个云雨图 &lt;br&gt;
- 与之前类似，将图片存入list中，并且命名为"RainCloud Plot" &lt;br&gt;
- 具体画法将在下一节课讲解 &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.3.8 plot: ggplot2&lt;/h1&gt; 
&lt;img src="./picture/chp10/plot.png" width="100%"&gt; &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.1.9 Third Commit&lt;/h1&gt; 
&lt;img src="./picture/chp10/third_commit.png" width="100%"&gt; &lt;br&gt;
- 至此我们就算用整洁的代码完成一个项目了 &lt;br&gt;

---
## &lt;h1 lang="en"&gt;Extra&lt;/h1&gt; 
&lt;img src="./picture/chp10/code_file.png" width="100%"&gt; &lt;br&gt;
- 做完后，感觉还可以更整洁一点，就把所有代码RMD文件放在了code文件夹中 &lt;br&gt;

---
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;span style="font-size: 60px;"&gt;10.4 OCD-level Codes&lt;/span&gt;&lt;/center&gt; &lt;br&gt;
&lt;br&gt;

&lt;span style="font-size: 30px;"&gt;- 10.4.3 Separate Codes&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.4.4 Functions&lt;/span&gt; &lt;br&gt;
&lt;span style="font-size: 30px;"&gt;- 10.4.5 Packages&lt;/span&gt; &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.4.1 Separate Codes&lt;/h1&gt; 
&lt;img src="./picture/chp10/separate_codes.png" width="100%"&gt; &lt;br&gt;
- 第一步，其实我们在刚刚的操作中几乎完成了 &lt;br&gt;
- 我们将清洗数据，方差分析和画图的代码分开了 &lt;br&gt;
- 但如果你代码中总会重复同一个操作，那么单单将不同内容的代码分开，可能并不能让代码更简洁 &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.4.2 Functions&lt;/h1&gt; 
&lt;img src="./picture/chp10/create_R.png" width="100%"&gt; &lt;br&gt;
- 创建一个R script文件 &lt;br&gt;
- 将我们的重复操作变成一个函数 &lt;br&gt;
- 待会儿会讲到的source和打包，都只识别R script，而不识别R markdown &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.4.2 Functions&lt;/h1&gt; 

```r
myfunction &lt;- function(df, Sub = "Sub", var1, var2, y) {
  df.clean &lt;- df %&gt;%
    # 输入的是字符串，需要用!!sym()将字符串转化为dplyr识别的列名
    dplyr::group_by(!!sym(Sub), !!sym(var1), !!sym(var2)) %&gt;%
    dplyr::summarise(RT_mean = mean(!!sym(y))) %&gt;%
    dplyr::ungroup()
  return(df.clean)
}
```
- 一个函数由这几部分构成 &lt;br&gt;
- 小括号内的argument，大括号内的函数本体 &lt;br&gt;
- 本质上是你告诉函数argument是什么，函数将这些argument带入本体中进行运算 &lt;br&gt;
- 最终返回一个你设定好的东西，可能是图片，可能是表格，可能是一个向量 &lt;br&gt;
- NOTE: 如果你在小括号内设定了某个argument的值，则是在设定这个argument的默认值 &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.4.2 Functions&lt;/h1&gt; 
&lt;img src="./picture/chp10/cleandata_withmyfunction.png" width="100%"&gt; &lt;br&gt;
- 如果你的重复操作(比如这里的清洗数据)非常长 &lt;br&gt;
- 那么使用function可以帮你节约很多行 &lt;br&gt;
- 最重要的是，这样代码看起来非常整洁(强迫症狂喜) &lt;br&gt;
&lt;br&gt;
- 但其实大多数情况下清洗数据并不会使用函数来封装，你需要展示你清洗数据的细节 &lt;br&gt;
- 当你需要重复计算某个值时，比如我想计算某个数据集的D prime，才会使用到函数 &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.4.2 Functions&lt;/h1&gt; 

```r
source("../functions/Functions.R")
```
- 如果你写了非常多的函数，可以用source命令一次调取 &lt;br&gt;
- 但这样的做法会让你的Global Environment充斥着函数 &lt;br&gt;
&lt;img src="./picture/chp10/functions_inGE.png" width="80%"&gt; &lt;br&gt;
- 你也不想你的Global Environment变成这样吧 &lt;br&gt;
&lt;br&gt;
_仅供举例，非Example中内容_

---
## &lt;h1 lang="en"&gt;10.4.5 Packages&lt;/h1&gt; 
- 或许最整洁的方法，是把自己写的函数打包 &lt;br&gt;
- 但这一部分可能比较困难，会出现很多bug &lt;br&gt;
- 有兴趣的可以去yuki的GitHub上看PPT学习(遇到bug问yuki) &lt;br&gt;
https://github.com/sinnyuki/Presentation/tree/main/230511_foreach%26package/PPT
&lt;br&gt;
&lt;img src="./picture/chp10/anya.png" width="50%"&gt; &lt;br&gt;

---
## &lt;h1 lang="en"&gt;10.4.5 Packages&lt;/h1&gt; 
&lt;img src="./picture/chp10/batch_shr.png" width="100%"&gt; &lt;br&gt;
- 比如我想计算一个数据集的蒙特卡洛分半信度(是否是蒙特卡洛，2种可能)&lt;br&gt;
- 每种指标的分半信度我都想计算，比如rt，acc，dprime等等(6种Indice) &lt;br&gt;
- 我还想指定这个分半信度是针对Self和Friend之间的，还是Self和Stranger之间的(2种Target) &lt;br&gt;
- 这种情况下，如果我要写函数，全局变量会出现2x6x2 = 24个函数 &lt;br&gt;
- 但是封装成包后，就只有一个命令 batch::shr &lt;br&gt;
&lt;br&gt;
_仅供举例，非Example中内容_
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
